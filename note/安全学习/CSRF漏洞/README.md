# CSRF (cross-site request forgery) 跨站请求伪造

原理：攻击者会伪造一个请求，欺骗用户进行点击，然后就完成了这次攻击 （也称为一次性攻击）

场景：

1. 修改用户收获地址，当你正在登录购物网站，在购物时，（另外一个攻击者也注册了这个平台，其可以伪造一个一样的请求），诱骗正在登录购物网站的用户去点击了这个请求，这个请求就被执行了。简单来说，就是攻击者用用户身份 修改了地址。

攻击满足条件：

1. 购物网站没有对增删改 进行 CSRF 的进行防护 CSRF 处理, 导致请求被伪造。
2. 需要用户主动点击这个伪造的请求，且有登录状态

## CSRF 和 xss 的区别

1. XSS 是直接获取用户的 cookie，主动登录用户的后台权限进行修改
2. CSRF 是借用户的权限完成攻击，攻击者并没有拿到用户的实际权限。

## 如何确认目标系统是否存在 CSRF 的漏洞

- 修改敏感信息，抓数据包，看数据包中是否有防 CSRF 的一些措施。
  - 如验证旧密码
  - 是否有携带 CSRF-token
  - 确认凭证的有效期，（用户离开后，是否及时清除token)

## Token是如何防止CSRF的？

CSRF的主要问题是敏感操作的链接容易被伪造，如何让这个链接如何不容易被伪造。

## 防范错失
- 增加token验证 
  - 对关键操作增加token，token值必须随机，每次不一样

安全会话的会话管理（避免会话被利用）
1. 不要再客户端保存敏感信息（比如身份验证信息）
2. 测试直接关闭，退出时 的会话机制
3. 设置会话过期机制，比如15分钟误操作，则自动登录超时

访问控制安全管理
1. 对敏感操作修改时，需要对身份进行二次认证，必须修改密码，需要验证旧密码
2. 敏感信息的修改用post, 不是get
3. 通过http头部的referer 来限制来源


增加验证码
- 一般在登录（放暴力破解），也可以在其他重要的信息操作的表单中



