# 安全编码原则

## 组件安全
- 禁止使用安全团队扫描出的安全组件
- 生产环境关闭调试&组件的报错功能

## 输入验证
- 必须可在安全的环境下校验数据 & 如在javascript环境下可存在被绕过的风险
- 对于不可信任的输入来源（http请求头，url、用户的参数）必须进行数据校验
- 判断输入是否符合预期的类型 如 长度 、类型、数据范围、字符集合等。
- 可以采用白名单的方式进行校验
- 对于SQl注入、 XSS、命令注入等常见的危险字符 <> ' " % | ; & / \ 需要结合业务场景进行过滤
- 对于一些输入最好使用一些过滤的框架去处理。

## 输出转译编码
- 模版编译 嵌套
- 对输出的<> 进行转移 &lt;


## 身份验证和会话管理
- 可使用验证码 （动态验证码）
- 避免在URL中使用会话标识
- cookie使用需要配置httponly 防止被xss漏洞/javascript操作泄漏

## 注册登录安全要点
- 注册时需要限制用户名字符合法和长度；
- 密码禁止使用弱口令，密码长度大于8且有大小写数字组成
- 登录失败时不返回详细的提示信息（如用户名或密码错误）防止用户名泄漏
- 口令多次失败应该有验证码机制，（验证码使用一次过应该失效）
- 记录成功的IP 时间
- 当尝试登录IP 不在历史常登录的位置时，应该多因素进行二次用户信息验证，防止用户因密码泄漏而被窃取账户

## 敏感业务/核心业务 采用登录态隔离


## 访问控制
- web页面 http API接口 ，除了静态页面、新闻、简介等公开内容，必须在系统设计上之初就要考虑身份验证和权限校验机制。仅有权限的用户才能访问相应的服务和数据，防止水平和垂直越权。
- 接口和页面被调用，应要求调用测保持一致的身份校验和权限校验机制，不允许调用侧使用固定单个身份的方式接入
- 对外开放被调用的接口与页面，应要求调用侧维持接口或页面原油最小粒度的单用户身份校验和权限控制机制，避免使用统一固定的单个用户验证

## 传输安全和加密
- 增删改必须使用post方式提交
- 必须使用https借口进行


## 数据保护
- 不要在客户端 本地存储 cookie存储中 使用明文 或者其他敏感信息
- 涉及个人隐私的敏感文件须加密存储且脱敏后给用户
- 对于资源id的每个请求要做权限校验 防止数据被遍历获取
- 对于高价值的数据，需要对用户UID，iP的来源做频率限制，防止核心数据被黑产，爬虫

## 文件上传安全
- 文件上传前必须验证用户身份
- 根据业务场景需要，必须以白名单的方式进行检验文件后缀名，最后要限制合适的文件大小
- 文件应该保存在在专门存储的位置 noSQL 环境 防止在web容器中执行 webShell 的风险
- 第三方存储，做好业务配置，防止存储的文件被遍历任意下载

## 数据的二次使用安全
- 在使用内部服务，上游的数据时，应该考虑到即使是使用内部服务的数据时也有可能被恶意携带参数
- 如：内部管理平台展示用户反馈的意见时被存储了 xss 攻击；
- 脚本在爬取上游传递的URL时没有过滤内网网址导致SSRF；
- 脚本调用系统wget,curl 爬取内部服务传递的URL时，没有考虑到URL可能是外部传入到上游服务器携带了恶意命令导致被入侵。

